{% extends 'store/base.html' %}
{% block title %}Products - Paint Store{% endblock %}
{% block meta %}
  {% if current_category_name %}
    <meta name="description" content="Sản phẩm trong danh mục {{ current_category_name }} — Paint Store." />
    <meta property="og:title" content="{{ current_category_name }} - Paint Store" />
    <meta property="og:description" content="Xem các sản phẩm trong danh mục {{ current_category_name }}" />
  {% elif current_brand_name %}
    <meta name="description" content="Sản phẩm của thương hiệu {{ current_brand_name }} — Paint Store." />
    <meta property="og:title" content="{{ current_brand_name }} - Paint Store" />
    <meta property="og:description" content="Sản phẩm thương hiệu {{ current_brand_name }}" />
  {% else %}
    <meta name="description" content="Danh sách sản phẩm sơn — Paint Store. Tìm theo thương hiệu, phân loại và giá." />
    <meta property="og:title" content="Products - Paint Store" />
    <meta property="og:description" content="Danh sách sản phẩm sơn" />
  {% endif %}
{% endblock %}
{% block content %}
  <div class="row">
    <aside class="col-md-3">
      <h5>Categories</h5>
      <ul class="list-group">
        {% for c in categories %}
          <li class="list-group-item"><a href="?category={{ c.id }}{% if q %}&q={{ q }}{% endif %}">{{ c.name }}</a></li>
        {% endfor %}
      </ul>
      <h5 class="mt-3">Brands</h5>
      <ul class="list-group">
        {% for b in brands %}
          <li class="list-group-item"><a href="?brand={{ b.id }}{% if q %}&q={{ q }}{% endif %}">{{ b.name }}</a></li>
        {% endfor %}
      </ul>
    </aside>

    <section class="col-md-9">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <form class="d-flex" method="get" action="{% url 'store:product_list' %}">
            <input type="hidden" name="category" value="{{ current_category }}">
            <input type="hidden" name="brand" value="{{ current_brand }}">
            <input type="hidden" name="q" value="{{ q }}">
            <input class="form-control form-control-sm me-2 input-compact" type="number" name="min_price" placeholder="Min" value="{{ min_price|default:'' }}">
            <input class="form-control form-control-sm me-2 input-compact" type="number" name="max_price" placeholder="Max" value="{{ max_price|default:'' }}">
            <select name="sort" class="form-select form-select-sm me-2 select-compact">
              <option value="">Sắp xếp</option>
              <option value="price_asc" {% if sort == 'price_asc' %}selected{% endif %}>Giá: tăng dần</option>
              <option value="price_desc" {% if sort == 'price_desc' %}selected{% endif %}>Giá: giảm dần</option>
              <option value="name_asc" {% if sort == 'name_asc' %}selected{% endif %}>Tên: A→Z</option>
              <option value="name_desc" {% if sort == 'name_desc' %}selected{% endif %}>Tên: Z→A</option>
            </select>
            <button class="btn btn-sm btn-outline-primary" type="submit">Áp dụng</button>
          </form>
        </div>
      </div>
      <div class="product-grid">
        {% load watermark_extras %}
        {% for p in products %}
          <div class="card">
                    {% if p.image %}
                      <img src="{{ p.image|watermarked }}" class="card-img-top lazy-img" loading="lazy" alt="{{ p.name }}">
                    {% else %}
                      <img src="{{ STATIC_URL }}images/product-placeholder.svg" class="card-img-top lazy-img" loading="lazy" alt="No image">
                    {% endif %}
            <div class="card-body">
              <h5 class="card-title">{{ p.name }}</h5>
              <p class="card-text">{{ p.price }} / {{ p.unit_type }} {{ p.volume }}</p>
              <a href="{% url 'store:product_detail' p.pk %}" class="btn btn-sm btn-primary">View</a>
            </div>
          </div>
        {% empty %}
          <p>No products.</p>
        {% endfor %}
      </div>

      <nav aria-label="Page navigation" class="mt-4">
        <ul class="pagination">
            {% if page_obj.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if q %}&q={{ q }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_brand %}&brand={{ current_brand }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}">Previous</a></li>
          {% endif %}
          <li class="page-item disabled"><span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span></li>
          {% if page_obj.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}{% if q %}&q={{ q }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_brand %}&brand={{ current_brand }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}">Next</a></li>
          {% endif %}
        </ul>
      </nav>
    </section>
  </div>
{% endblock %}
