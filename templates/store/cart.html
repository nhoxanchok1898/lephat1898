{% extends 'store/base.html' %}
{% load static %}
{% load watermark_extras %}
{% block title %}Giỏ hàng - Paint Store{% endblock %}
{% block content %}
  <section class="cart-page container">
    <h2 class="mb-3">Giỏ hàng của bạn</h2>
    {% if items %}
      <div class="cart-grid">
        <div class="cart-items">
          {% for it in items %}
            <div class="cart-row card" data-pk="{{ it.product.pk }}" data-price="{{ it.product.price }}">
              <div class="cart-thumb">
                {% if it.product.image %}
                  <img src="{{ it.product.image|watermarked }}" alt="{{ it.product.name }}">
                {% else %}
                  <img src="{% static 'images/product-placeholder.svg' %}" alt="No image">
                {% endif %}
              </div>
              <div class="cart-meta">
                <div class="title">{{ it.product.name }}</div>
                <div class="muted">{{ it.product.brand.name }}</div>
              </div>
              <div class="cart-actions">
                <div class="price">{{ it.product.price }}</div>
                <div class="item-subtotal" data-subtotal="{{ it.subtotal }}">Tạm: <span class="muted">{{ it.subtotal }}</span></div>
                <form method="post" action="{% url 'store:cart_update' it.product.pk %}" class="cart-update-form">
                  {% csrf_token %}
                  <label class="form-label visually-hidden">Số lượng</label>
                  <div class="qty-input-group">
                    <button type="button" class="btn btn-sm qty-decrement" aria-label="Decrease">−</button>
                    <input type="number" name="quantity" value="{{ it.qty }}" min="0" class="form-control form-control-sm qty-input" style="width:84px;display:inline-block;margin:0 8px">
                    <button type="button" class="btn btn-sm qty-increment" aria-label="Increase">+</button>
                    <button type="submit" class="btn btn-sm btn-outline-secondary">Cập nhật</button>
                  </div>
                </form>
                <div class="mt-2"><a href="{% url 'store:cart_remove' it.product.pk %}" class="btn btn-sm btn-outline-danger">Xóa</a></div>
              </div>
            </div>
          {% endfor %}
        </div>
        <aside class="cart-summary card">
          <h4>Tóm tắt đơn hàng</h4>
          <div class="summary-line">Tạm tính: <span class="price" id="cart-total">{{ total }}</span></div>
          <div class="mt-3">
            <a href="{% url 'store:product_list' %}" class="btn btn-outline-primary w-100 mb-2">Tiếp tục mua</a>
            <a href="{% url 'store:checkout' %}" class="btn w-100">Thanh toán</a>
          </div>
        </aside>
      </div>
    {% else %}
      <p>Giỏ hàng trống.</p>
      <a href="{% url 'store:product_list' %}" class="btn btn">Xem sản phẩm</a>
    {% endif %}
  </section>
{% endblock %}